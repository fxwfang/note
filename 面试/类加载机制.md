## 类加载机制



### 如果让你设计一个类加载机制，需要注意什么？



### 问题

```
*  类加载机制的概述
1. Java类的生命周期？ -- 七个阶段
2. 虚拟机如何加载一个Class文件呢   -- Java类加载的方式：类加载器、双亲委派机制
3. 虚拟机什么时候才会加载Class文件并初始化类呢？ -- 类的加载时机
4. 双亲委派机制是什么？"双亲"?
5. 类加载器为什么要分为3种，一种不行吗？有什么区别？

```



#### Java类的生命周期？

Java类从被加载到虚拟机内存中开始，到卸载出内存为止，它的整个生命周期包括：加载（Loading）、验证（Verification）、准备(Preparation)、解析(Resolution)、初始化(Initialization)、使用(Using) 和 卸载(Unloading)七个阶段。其中准备、验证、解析3个部分统称为连接（Linking）。

![image-20210112233219587](/Users/fangxiaowei/git/note/面试/类加载机制/images/image-20210112233219587.png)

#### 



#### 类的加载时机,什么时候会对类进行加载“初始化”？

虚拟机规范严格规定了有且只有5中情况（jdk1.7）必须对类进行“初始化”（而加载、验证、准备自然需要在此之前开始）：

1. 遇到new,getstatic,putstatic,invokestatic这失调字节码指令时，如果类没有进行过初始化，则需要先触发其初始化。生成这4条指令的最常见的Java代码场景是：使用new关键字实例化对象的时候、读取或设置一个类的静态字段（被final修饰、已在编译器把结果放入常量池的静态字段除外）的时候，以及调用一个类的静态方法的时候。
2. 使用java.lang.reflect包的方法对类进行反射调用的时候，如果类没有进行过初始化，则需要先触发其初始化。
3. 当初始化一个类的时候，如果发现其父类还没有进行过初始化，则需要先触发其父类的初始化。
4. 当虚拟机启动时，用户需要指定一个要执行的主类（包含main()方法的那个类），虚拟机会先初始化这个主类。
5. 当使用jdk1.7动态语言支持时，如果一个java.lang.invoke.MethodHandle实例最后的解析结果REF_getstatic,REF_putstatic,REF_invokeStatic的方法句柄，并且这个方法句柄所对应的类没有进行初始化，则需要先出触发其初始化。

 











### 参考

[JVM类生命周期概述：加载时机与加载过程](https://blog.csdn.net/justloveyou_/article/details/72466105)

[Java虚拟机类加载机制](https://blog.csdn.net/u013256816/article/details/50829596)

[深入理解Java类加载器(一)：Java类加载原理解析](https://blog.csdn.net/justloveyou_/article/details/72217806)

[深入理解Java类加载器(1)：Java类加载原理解析](https://blog.csdn.net/zhoudaxia/article/details/35824249)

[双亲委派模型与线程上下文类加载器](https://blog.csdn.net/justloveyou_/article/details/72231425)