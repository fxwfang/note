#### 分布式事务



#### 事务的特性

ACID:
本地事务
分布式事务

#### 分布式事务的问题

````

begin transaction;
// 1.本数据库操作： 张三减少金额
// 2. 远程调研： 让李四增加金额
commit transaction;

````



存在的问题：
步骤1成功，步骤2也成功，但是2由于网络超时，导致整体操作失败，步骤1会回滚，但是步骤2回滚不来。

#### 分布式事务产生的场景



1. 分布式架构场景，跨JVM
2. 单体系统访问多个数据库实例
3. 多服务访问同一个数据库

#### 分布式事务基础理论

目标是什么？要控制到什么程度？

#### CAP理论
一致性 可用性  、分区容忍性
#### 一致性Consistency: 
一致性是指写操作后的读操作可以读取到最新的数据状态，当数据分布在多个节点上，从任意节点读取到的数据都是最新的状态。
如何实现一致性：
1.写入主数据库后要将数据同步到从数据库
2.写入主数据库后，在向从数据库同步期间要将数据库锁定，待同步完成后再释放锁，以免在新数据写入成功后，向从数据库查询到旧的数据。

#### 可用性 Availability
  可用性指任何事物操作都可以得到响应结果，且不会出现超时或响应错误。
如何实现可用性？
1、写入主数据库后要将数据同步给从数据库
2、由于要保证数据库的一致性，不可将数据库的资源进行锁定。
3、即使数据还没有同步过来，从数据库也要返回要查的数据，哪怕是旧的数据，如果连旧数据也没有则可以按照约定返回默认信息但不能返回错误或响应超时。

#### 分区容错性 Partition tilerance

   通常分布式系统的各个节点部署在不同的子网，这就是网络分区，不可避免的会出现由于网络问题而导致结点之间通信失败，此时仍可对外提供服务，这就叫分区容忍性。



### BASE 理论

基本可用 Basically Available

软状态 Solf State

最终一致性 Eventually Consistent 





















